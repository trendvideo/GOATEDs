<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GOATED Clan.CODM - Elite Mobile Warfare</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff4655;
            --secondary: #0f1923;
            --dark: #1a2a3a;
            --light: #ece8e1;
            --danger: #f44336;
            --success: #4CAF50;
            --warning: #ff9800;
            --info: #2196F3;
            --gold: #FFD700;
            --legendary: #9c27b0;
            --notification: #ff4655;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
            --male-color: #3498db;
            --female-color: #e91e63;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--secondary);
            color: var(--light);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background-image: url('https://images.contentstack.io/v3/assets/bltb6530b271fddd0b1/blt29d7c4f6bc077e9e/5eb26f54402b8b4d13a56656/COD_Mobile_Season_7_Key_Art.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-blend-mode: overlay;
            line-height: 1.6;
        }
        
        .container {
            background-color: rgba(26, 42, 58, 0.95);
            border-radius: 10px;
            padding: 30px;
            width: 100%;
            max-width: 800px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(to right, var(--primary), var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }
        
        .tagline {
            color: rgba(236, 232, 225, 0.8);
            font-size: 0.9rem;
            margin-bottom: 20px;
            font-style: italic;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: rgba(236, 232, 225, 0.9);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border-radius: 5px;
            border: none;
            background-color: rgba(45, 58, 74, 0.8);
            color: var(--light);
            font-size: 16px;
            transition: var(--transition);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(255, 70, 85, 0.3);
        }
        
        button {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            transition: var(--transition);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            background: #ff2d3e;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 70, 85, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .success-message {
            color: var(--success);
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .dashboard {
            display: none;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }
        
        .user-info {
            background: rgba(45, 58, 74, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .profile-pic-container {
            position: relative;
            width: 100px;
            height: 100px;
            margin-bottom: 15px;
        }
        
        .profile-pic {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
        }
        
        .profile-pic-upload {
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .profile-pic-upload input {
            display: none;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-left: 5px;
        }
        
        .status-pending {
            background: var(--warning);
            color: black;
        }
        
        .status-accepted {
            background: var(--success);
            color: white;
        }
        
        .status-rejected {
            background: var(--danger);
            color: white;
        }
        
        .status-member {
            background: var(--info);
            color: white;
        }
        
        .status-admin {
            background: var(--legendary);
            color: white;
        }
        
        .status-applicant {
            background: var(--warning);
            color: black;
        }
        
        .application-form {
            margin-top: 20px;
        }
        
        textarea {
            width: 100%;
            min-height: 120px;
            padding: 12px;
            border-radius: 5px;
            background: rgba(45, 58, 74, 0.8);
            color: var(--light);
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            resize: vertical;
            font-family: inherit;
        }
        
        .logout-btn {
            background: #607d8b;
            margin-top: 30px;
        }
        
        .logout-btn:hover {
            background: #546e7a;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(96, 125, 139, 0.4);
        }
        
        .admin-dashboard {
            display: none;
        }
        
        .admin-alert {
            background: var(--danger);
            color: white;
            padding: 12px;
            border-radius: 5px;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            border-left: 5px solid white;
        }
        
        .user-card {
            background: rgba(45, 58, 74, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .admin-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .accept-btn {
            background: var(--success);
        }
        
        .accept-btn:hover {
            background: #3d8b40;
        }
        
        .reject-btn {
            background: var(--danger);
        }
        
        .reject-btn:hover {
            background: #d32f2f;
        }
        
        .ban-btn {
            background: var(--danger);
        }
        
        .ban-btn:hover {
            background: #d32f2f;
        }
        
        .secondary-btn {
            background: #607d8b;
        }
        
        .secondary-btn:hover {
            background: #546e7a;
        }
        
        .rank-info {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .rank-column {
            flex: 1;
        }
        
        .activity-log {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            padding: 10px;
            background: rgba(45, 58, 74, 0.3);
        }
        
        .activity-item {
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 14px;
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            color: rgba(236, 232, 225, 0.6);
            font-size: 12px;
            margin-top: 3px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            overflow-x: auto;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary);
            color: var(--primary);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .account-actions {
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }
        
        .danger-zone {
            margin-top: 30px;
            padding: 15px;
            border-radius: 5px;
            background: rgba(244, 67, 54, 0.1);
            border: 1px solid var(--danger);
        }
        
        .danger-zone h4 {
            color: var(--danger);
            margin-bottom: 10px;
        }
        
        .rank-legendary {
            color: var(--legendary);
            font-weight: bold;
        }
        
        .rank-gold {
            color: var(--gold);
            font-weight: bold;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .notification-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--notification);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--dark);
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: var(--shadow);
            border-left: 5px solid var(--primary);
            z-index: 1000;
            display: flex;
            align-items: center;
            transform: translateX(200%);
            transition: transform 0.3s ease;
            max-width: 350px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left-color: var(--success);
        }
        
        .notification.error {
            border-left-color: var(--danger);
        }
        
        .notification.warning {
            border-left-color: var(--warning);
        }
        
        .notification-icon {
            margin-right: 10px;
            font-size: 20px;
        }
        
        .notification-close {
            margin-left: 10px;
            cursor: pointer;
            opacity: 0.7;
        }
        
        .notification-close:hover {
            opacity: 1;
        }
        
        .clan-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(45, 58, 74, 0.5);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin: 5px 0;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 14px;
            color: rgba(236, 232, 225, 0.8);
        }
        
        .member-list {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .member-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }
        
        .member-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .member-item:last-child {
            border-bottom: none;
        }
        
        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            overflow: hidden;
        }
        
        .member-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .member-info {
            flex: 1;
        }
        
        .member-name {
            font-weight: bold;
        }
        
        .member-details {
            font-size: 12px;
            color: rgba(236, 232, 225, 0.7);
            margin-top: 3px;
        }
        
        /* Clan Settings Editor Styles */
        .clan-stats-settings {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .activity-edit-item, .member-edit-item {
            background: rgba(45, 58, 74, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .remove-activity, .remove-member {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .remove-activity:hover, .remove-member:hover {
            transform: scale(1.1);
        }
        
        .member-avatar-edit {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            overflow: hidden;
            position: relative;
        }
        
        .member-avatar-edit img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .member-edit-fields {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 200px;
            margin-top: 10px;
            border-radius: 5px;
            display: none;
        }
        
        .clan-banner {
            width: 100%;
            height: 150px;
            background-color: rgba(45, 58, 74, 0.5);
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .clan-banner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .clan-banner-upload {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--primary);
            color: white;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .clan-banner-upload:hover {
            background: #ff2d3e;
        }
        
        .clan-banner-upload input {
            display: none;
        }
        
        /* Website Settings Styles */
        .website-settings {
            margin-top: 30px;
            padding: 20px;
            background: rgba(45, 58, 74, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            color: white;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }
        
        /* Gender selection */
        .gender-selection {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .gender-option {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .gender-option.selected {
            border-color: var(--primary);
        }
        
        .gender-option.male {
            background: rgba(52, 152, 219, 0.2);
        }
        
        .gender-option.male.selected {
            background: rgba(52, 152, 219, 0.5);
            border-color: var(--male-color);
        }
        
        .gender-option.female {
            background: rgba(233, 30, 99, 0.2);
        }
        
        .gender-option.female.selected {
            background: rgba(233, 30, 99, 0.5);
            border-color: var(--female-color);
        }
        
        /* Robot avatar */
        .robot-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 40px;
            background-color: #333;
            color: white;
            border: 3px solid var(--primary);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .rank-info {
                flex-direction: column;
                gap: 10px;
            }
            
            .admin-actions {
                flex-direction: column;
            }
            
            .admin-actions button {
                width: 100%;
            }
            
            .clan-stats, .clan-stats-settings {
                grid-template-columns: 1fr;
            }
            
            .notification {
                width: calc(100% - 40px);
                left: 20px;
                right: auto;
            }
            
            .member-edit-fields {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .member-avatar-edit {
                margin-bottom: 10px;
            }
            
            .logo {
                font-size: 2rem;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .tab {
                padding: 8px 12px;
                font-size: 14px;
            }
            
            button {
                padding: 12px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p id="loadingText">Loading...</p>
    </div>

    <!-- Notification System -->
    <div id="notificationContainer"></div>

    <!-- Login Container -->
    <div class="container" id="loginContainer">
        <header>
            <div class="logo" id="mainLogo">GOATED Clan.CODM</div>
            <p class="tagline" id="mainTagline">Elite Mobile Warfare | Season 7</p>
        </header>
        
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" placeholder="Enter your username" required>
        </div>
        
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" placeholder="Enter your password" required>
        </div>
        
        <button onclick="login()">
            <i class="fas fa-sign-in-alt"></i> Login
        </button>
        <button onclick="showAdminLogin()" style="background: var(--legendary); margin-top: 10px;">
            <i class="fas fa-user-shield"></i> Admin Login
        </button>
        
        <p id="loginError" class="error-message"></p>
        
        <p style="text-align: center; margin-top: 20px; color: rgba(236, 232, 225, 0.7);">
            Don't have an account? <a href="#" onclick="showRegister()" style="color: var(--primary); text-decoration: none; font-weight: bold;">Register here</a>
        </p>
    </div>
    
    <!-- Register Container -->
    <div class="container" id="registerContainer" style="display: none;">
        <header>
            <div class="logo" id="registerLogo">Join GOATED Clan</div>
            <p class="tagline" id="registerTagline">Prove your worth on the battlefield</p>
        </header>
        
        <div class="robot-avatar" id="robotAvatar">🤖</div>
        
        <div class="gender-selection">
            <div class="gender-option male" onclick="selectGender('male')">
                <i class="fas fa-mars"></i> Male
            </div>
            <div class="gender-option female" onclick="selectGender('female')">
                <i class="fas fa-venus"></i> Female
            </div>
        </div>
        
        <div class="form-group">
            <label for="regUsername">Username</label>
            <input type="text" id="regUsername" placeholder="Choose a username" required>
        </div>
        
        <div class="form-group">
            <label for="regPassword">Password (min 8 characters)</label>
            <input type="password" id="regPassword" placeholder="Create a strong password" required minlength="8">
        </div>
        
        <div class="form-group">
            <label for="regCODMName">CODM In-Game Name</label>
            <input type="text" id="regCODMName" placeholder="Your exact Call of Duty: Mobile username" required>
        </div>
        
        <div class="form-group">
            <label for="regLevel">Account Level (1-400)</label>
            <input type="number" id="regLevel" placeholder="Your current level" min="1" max="400" required>
        </div>
        
        <div class="rank-info">
            <div class="rank-column">
                <label for="regMPRank">Multiplayer Rank</label>
                <select id="regMPRank" required>
                    <option value="">Select Rank</option>
                    <option value="Rookie">Rookie</option>
                    <option value="Veteran">Veteran</option>
                    <option value="Elite">Elite</option>
                    <option value="Pro">Pro</option>
                    <option value="Master">Master</option>
                    <option value="Legendary" class="rank-legendary">Legendary</option>
                </select>
            </div>
            <div class="rank-column">
                <label for="regBRRank">Battle Royale Rank</label>
                <select id="regBRRank" required>
                    <option value="">Select Rank</option>
                    <option value="Rookie">Rookie</option>
                    <option value="Veteran">Veteran</option>
                    <option value="Elite">Elite</option>
                    <option value="Pro">Pro</option>
                    <option value="Master">Master</option>
                    <option value="Legendary" class="rank-legendary">Legendary</option>
                </select>
            </div>
        </div>
        
        <button onclick="register()">
            <i class="fas fa-user-plus"></i> Register
        </button>
        <p id="registerError" class="error-message"></p>
        <p id="registerSuccess" class="success-message"></p>
        
        <button class="logout-btn" onclick="showLogin()">
            <i class="fas fa-arrow-left"></i> Back to Login
        </button>
    </div>
    
    <!-- User Dashboard -->
    <div class="container dashboard" id="userDashboard">
        <div class="dashboard-header">
            <h2>Welcome, <span id="dashboardUsername"></span></h2>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        
        <div class="user-info">
            <div class="profile-pic-container">
                <div class="robot-avatar" id="userRobotAvatar">🤖</div>
                <label class="profile-pic-upload">
                    <input type="file" id="profilePicUpload" accept="image/*" onchange="uploadProfilePicture()" capture="camera">
                    <i class="fas fa-camera"></i>
                </label>
            </div>
            <p>Gender: <strong id="dashboardGender"></strong></p>
            <p>CODM Name: <strong id="dashboardCODMName"></strong></p>
            <p>Account Level: <strong id="dashboardLevel"></strong></p>
            <p>MP Rank: <strong id="dashboardMPRank"></strong></p>
            <p>BR Rank: <strong id="dashboardBRRank"></strong></p>
            <p>Status: <span id="dashboardStatus" class="status-badge"></span></p>
        </div>
        
        <div class="tab-container">
            <div class="tab active" onclick="switchTab('applicationTab')">
                <i class="fas fa-file-alt"></i> Application
            </div>
            <div class="tab" onclick="switchTab('accountTab')">
                <i class="fas fa-user-cog"></i> Account
            </div>
            <div class="tab" onclick="switchTab('clanTab')">
                <i class="fas fa-users"></i> Clan Info
            </div>
        </div>
        
        <div id="applicationTab" class="tab-content active">
            <div id="applicationStatus">
                <h3><i class="fas fa-file-signature"></i> Clan Application</h3>
                <div id="statusMessage">
                    <p>You haven't submitted an application yet.</p>
                    <button onclick="showApplicationForm()">
                        <i class="fas fa-paper-plane"></i> Apply to Join Clan
                    </button>
                </div>
            </div>
            
            <div id="applicationForm" class="application-form" style="display: none;">
                <h3><i class="fas fa-edit"></i> Application Form</h3>
                <p style="margin-bottom: 15px; color: rgba(236, 232, 225, 0.8);">
                    Please provide detailed information about your skills and experience. Legendary ranked players get priority review.
                </p>
                <label for="applicationReason">Why should you join GOATED Clan? (Min. 100 characters)</label>
                <textarea id="applicationReason" placeholder="Tell us about your skills, experience, play style, preferred roles, and why you want to join our clan... (Minimum 100 characters)" minlength="100"></textarea>
                <button onclick="submitApplication()">
                    <i class="fas fa-paper-plane"></i> Submit Application
                </button>
                <button class="logout-btn" onclick="hideApplicationForm()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
        
        <div id="accountTab" class="tab-content">
            <h3><i class="fas fa-user-cog"></i> Account Settings</h3>
            
            <div class="form-group">
                <label for="changePasswordCurrent">Current Password</label>
                <input type="password" id="changePasswordCurrent" placeholder="Enter your current password">
            </div>
            
            <div class="form-group">
                <label for="changePasswordNew">New Password</label>
                <input type="password" id="changePasswordNew" placeholder="Enter new password (min 8 characters)" minlength="8">
            </div>
            
            <div class="form-group">
                <label for="changePasswordConfirm">Confirm New Password</label>
                <input type="password" id="changePasswordConfirm" placeholder="Confirm new password">
            </div>
            
            <button onclick="changePassword()">
                <i class="fas fa-key"></i> Change Password
            </button>
            <p id="passwordChangeError" class="error-message"></p>
            <p id="passwordChangeSuccess" class="success-message"></p>
            
            <div class="danger-zone">
                <h4><i class="fas fa-exclamation-triangle"></i> Danger Zone</h4>
                <p style="margin-bottom: 10px; color: rgba(236, 232, 225, 0.8);">
                    Deleting your account will remove all your data permanently. This action cannot be undone.
                </p>
                <button class="ban-btn" onclick="confirmDeleteAccount()">
                    <i class="fas fa-trash-alt"></i> Delete My Account
                </button>
            </div>
        </div>
        
        <div id="clanTab" class="tab-content">
            <div class="clan-banner">
                <img id="clanBannerImg" src="" alt="Clan Banner">
                <label class="clan-banner-upload" style="display: none;" id="clanBannerUploadBtn">
                    <input type="file" id="clanBannerUpload" accept="image/*" onchange="uploadClanBanner()" capture="camera">
                    <i class="fas fa-camera"></i> Change Banner
                </label>
            </div>
            
            <h3><i class="fas fa-info-circle"></i> Clan Information</h3>
            
            <div class="clan-stats">
                <div class="stat-card">
                    <div class="stat-value" id="totalMembers">47</div>
                    <div class="stat-label">Total Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="legendaryPlayers">12</div>
                    <div class="stat-label">Legendary Players</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgLevel">287</div>
                    <div class="stat-label">Average Level</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="winRate">72%</div>
                    <div class="stat-label">Tournament Win Rate</div>
                </div>
            </div>
            
            <h4><i class="fas fa-history"></i> Recent Clan Activity</h4>
            <div class="activity-log" id="clanActivityLog">
                <!-- Activities will be loaded here -->
            </div>
            
            <h4 style="margin-top: 20px;"><i class="fas fa-trophy"></i> Top Members</h4>
            <div class="member-list" id="clanTopMembers">
                <!-- Top members will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Admin Login -->
    <div class="container" id="adminLoginContainer" style="display: none;">
        <header>
            <div class="logo">Admin Portal</div>
            <p class="tagline">GOATED Clan Management System</p>
        </header>
        
        <div class="form-group">
            <label for="adminUsername">Username</label>
            <input type="text" id="adminUsername" placeholder="Enter admin username" required>
        </div>
        
        <div class="form-group">
            <label for="adminPassword">Password</label>
            <input type="password" id="adminPassword" placeholder="Enter admin password" required>
        </div>
        
        <button onclick="adminLogin()">
            <i class="fas fa-sign-in-alt"></i> Login
        </button>
        <p id="adminLoginError" class="error-message"></p>
        
        <button class="logout-btn" onclick="showLogin()">
            <i class="fas fa-arrow-left"></i> Back to Login
        </button>
    </div>
    
    <!-- Admin Dashboard -->
    <div class="container admin-dashboard" id="adminDashboard">
        <div class="admin-alert">
            <i class="fas fa-shield-alt"></i> ADMIN DASHBOARD - RESTRICTED ACCESS | Last login: <span id="lastLoginTime"></span>
            <div id="adminNotificationBadge" class="notification-badge" style="display: none;"></div>
        </div>
        
        <div class="dashboard-header">
            <h2>Admin Dashboard</h2>
            <button class="logout-btn" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> Logout
            </button>
        </div>
        
        <div class="tab-container">
            <div class="tab active" onclick="switchAdminTab('applicationsTab')">
                <i class="fas fa-file-alt"></i> Applications
            </div>
            <div class="tab" onclick="switchAdminTab('usersTab')">
                <i class="fas fa-users"></i> Users
            </div>
            <div class="tab" onclick="switchAdminTab('activityTab')">
                <i class="fas fa-history"></i> Activity
            </div>
            <div class="tab" onclick="switchAdminTab('notificationsTab')">
                <i class="fas fa-bell"></i> Notifications
            </div>
            <div class="tab" onclick="switchAdminTab('clanSettingsTab')">
                <i class="fas fa-cog"></i> Clan Settings
            </div>
            <div class="tab" onclick="switchAdminTab('websiteSettingsTab')">
                <i class="fas fa-globe"></i> Website
            </div>
        </div>
        
        <div id="applicationsTab" class="tab-content active">
            <h3><i class="fas fa-file-signature"></i> Pending Applications <span id="pendingAppsCount" class="status-badge status-pending" style="display: none;"></span></h3>
            <div id="applicationsList">
                <!-- Applications will be loaded here -->
            </div>
        </div>
        
        <div id="usersTab" class="tab-content">
            <h3><i class="fas fa-user-friends"></i> User Management</h3>
            <div id="usersList">
                <!-- Users will be loaded here -->
            </div>
        </div>
        
        <div id="activityTab" class="tab-content">
            <h3><i class="fas fa-clipboard-list"></i> Activity Log</h3>
            <div class="activity-log" id="activityLog">
                <!-- Activity logs will be loaded here -->
            </div>
        </div>
        
        <div id="notificationsTab" class="tab-content">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <div class="activity-log" id="notificationsList">
                <!-- Notifications will be loaded here -->
            </div>
        </div>
        
        <div id="clanSettingsTab" class="tab-content">
            <h3><i class="fas fa-flag"></i> Clan Settings</h3>
            
            <div class="form-group">
                <label for="clanName">Clan Name</label>
                <input type="text" id="clanName" placeholder="Enter clan name" value="GOATED Clan.CODM">
            </div>
            
            <div class="form-group">
                <label for="clanTag">Clan Tag</label>
                <input type="text" id="clanTag" placeholder="Enter clan tag (e.g., GOAT)" maxlength="4" value="GOAT">
            </div>
            
            <div class="form-group">
                <label for="clanLogo">Clan Logo</label>
                <input type="file" id="clanLogo" accept="image/*" onchange="previewClanLogo()" capture="camera">
                <img id="clanLogoPreview" class="image-preview" src="" alt="Clan Logo Preview">
            </div>
            
            <div class="form-group">
                <label for="clanBanner">Clan Banner</label>
                <input type="file" id="clanBanner" accept="image/*" onchange="previewClanBanner()" capture="camera">
                <img id="clanBannerPreview" class="image-preview" src="" alt="Clan Banner Preview">
            </div>
            
            <h4 style="margin-top: 20px;"><i class="fas fa-chart-bar"></i> Clan Statistics</h4>
            
            <div class="clan-stats-settings">
                <div class="form-group">
                    <label for="totalMembersSetting">Total Members</label>
                    <input type="number" id="totalMembersSetting" min="0" value="47">
                </div>
                
                <div class="form-group">
                    <label for="legendaryPlayersSetting">Legendary Players</label>
                    <input type="number" id="legendaryPlayersSetting" min="0" value="12">
                </div>
                
                <div class="form-group">
                    <label for="avgLevelSetting">Average Level</label>
                    <input type="number" id="avgLevelSetting" min="1" max="400" value="287">
                </div>
                
                <div class="form-group">
                    <label for="winRateSetting">Tournament Win Rate (%)</label>
                    <input type="number" id="winRateSetting" min="0" max="100" value="72">
                </div>
            </div>
            
            <h4 style="margin-top: 20px;"><i class="fas fa-history"></i> Recent Clan Activity</h4>
            <div id="clanActivities">
                <!-- Activities will be loaded here -->
            </div>
            <button class="secondary-btn" onclick="addActivityField()" style="margin-top: 10px;">
                <i class="fas fa-plus"></i> Add Activity
            </button>
            
            <h4 style="margin-top: 20px;"><i class="fas fa-trophy"></i> Top Members</h4>
            <div id="topMembers">
                <!-- Top members will be loaded here -->
            </div>
            <button class="secondary-btn" onclick="addTopMemberField()" style="margin-top: 10px;">
                <i class="fas fa-plus"></i> Add Top Member
            </button>
            
            <button onclick="saveClanSettings()" style="margin-top: 30px;">
                <i class="fas fa-save"></i> Save Clan Settings
            </button>
            <p id="clanSettingsError" class="error-message"></p>
            <p id="clanSettingsSuccess" class="success-message"></p>
        </div>
        
        <div id="websiteSettingsTab" class="tab-content">
            <h3><i class="fas fa-globe"></i> Website Settings</h3>
            <div class="website-settings">
                <div class="form-group">
                    <label for="websiteName">Website Name</label>
                    <input type="text" id="websiteName" placeholder="Enter website name" value="GOATED Clan.CODM">
                </div>
                
                <div class="form-group">
                    <label for="websiteTagline">Website Tagline</label>
                    <input type="text" id="websiteTagline" placeholder="Enter website tagline" value="Elite Mobile Warfare | Season 7">
                </div>
                
                <div class="form-group">
                    <label for="websiteLogo">Website Logo</label>
                    <input type="file" id="websiteLogo" accept="image/*" onchange="previewWebsiteLogo()" capture="camera">
                    <img id="websiteLogoPreview" class="image-preview" src="" alt="Website Logo Preview">
                </div>
                
                <div class="form-group">
                    <label for="websiteBackground">Background Image</label>
                    <input type="file" id="websiteBackground" accept="image/*" onchange="previewWebsiteBackground()" capture="camera">
                    <img id="websiteBackgroundPreview" class="image-preview" src="" alt="Background Preview">
                </div>
                
                <div class="form-group">
                    <label for="websiteTheme">Theme Color</label>
                    <select id="websiteTheme">
                        <option value="default" selected>Default (Red/Black)</option>
                        <option value="blue">Blue</option>
                        <option value="green">Green</option>
                        <option value="purple">Purple</option>
                        <option value="gold">Gold</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="websiteRegistration">Allow New Registrations</label>
                    <select id="websiteRegistration">
                        <option value="true" selected>Yes</option>
                        <option value="false">No</option>
                    </select>
                </div>
                
                <button onclick="saveWebsiteSettings()" style="margin-top: 20px;">
                    <i class="fas fa-save"></i> Save Website Settings
                </button>
                <p id="websiteSettingsError" class="error-message"></p>
                <p id="websiteSettingsSuccess" class="success-message"></p>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Database with more realistic data
        let users = [
            {
                id: 1,
                username: "player1",
                password: "test123",
                codmName: "CODM_Player1",
                level: 150,
                mpRank: "Master",
                brRank: "Pro",
                isAdmin: false,
                status: "Pending",
                joinDate: new Date(2023, 5, 15).toISOString(),
                notifications: [],
                profilePic: "",
                gender: "male",
                robotAvatar: "🤖"
            },
            {
                id: 2,
                username: "admin",
                password: "admin123",
                codmName: "DEADSHOT",
                level: 400,
                mpRank: "Legendary",
                brRank: "Legendary",
                isAdmin: true,
                status: "Admin",
                joinDate: new Date(2023, 0, 1).toISOString(),
                notifications: [],
                profilePic: "",
                gender: "male",
                robotAvatar: "🤖"
            },
            {
                id: 3,
                username: "proplayer",
                password: "codmpro",
                codmName: "SniperKing",
                level: 300,
                mpRank: "Legendary",
                brRank: "Master",
                isAdmin: false,
                status: "Member",
                joinDate: new Date(2023, 3, 22).toISOString(),
                notifications: [],
                profilePic: "",
                gender: "female",
                robotAvatar: "👩"
            }
        ];
        
        let applications = [
            {
                id: 1,
                userId: 1,
                username: "player1",
                codmName: "CODM_Player1",
                level: 150,
                mpRank: "Master",
                brRank: "Pro",
                reason: "I want to join the clan to improve my skills and compete in tournaments. I have experience in ranked MP and regularly play BR with my squad.",
                status: "Pending",
                applyDate: new Date(2023, 5, 16).toISOString(),
                reviewed: false
            }
        ];
        
        let activityLogs = [
            {
                id: 1,
                type: "login",
                userId: 2,
                username: "admin",
                message: "Admin logged in",
                timestamp: new Date().toISOString()
            },
            {
                id: 2,
                type: "application",
                userId: 1,
                username: "player1",
                message: "New application submitted by player1 (CODM_Player1)",
                timestamp: new Date(2023, 5, 16).toISOString()
            },
            {
                id: 3,
                type: "registration",
                userId: 3,
                username: "proplayer",
                message: "New user registered: proplayer (SniperKing)",
                timestamp: new Date(2023, 3, 22).toISOString()
            }
        ];
        
        let notifications = [
            {
                id: 1,
                userId: 2, // Admin user ID
                type: "new-application",
                title: "New Clan Application",
                message: "player1 has submitted an application to join the clan",
                timestamp: new Date(2023, 5, 16).toISOString(),
                read: false,
                relatedId: 1 // Application ID
            },
            {
                id: 2,
                userId: 1, // player1
                type: "application-status",
                title: "Application Update",
                message: "Your clan application is pending review",
                timestamp: new Date(2023, 5, 16).toISOString(),
                read: false,
                relatedId: 1 // Application ID
            }
        ];
        
        // Clan settings data
        let clanSettings = {
            name: "GOATED Clan.CODM",
            tag: "GOAT",
            logo: "",
            banner: "",
            stats: {
                totalMembers: 47,
                legendaryPlayers: 12,
                avgLevel: 287,
                winRate: 72
            },
            activities: [
                {
                    icon: "🎖️",
                    text: "Clan ranked #3 in last week's tournament",
                    daysAgo: 2
                },
                {
                    icon: "🏆",
                    text: "Tournament registration opens tomorrow",
                    daysAgo: 4
                },
                {
                    icon: "🆕",
                    text: "3 new members joined this week",
                    daysAgo: 7
                }
            ],
            topMembers: [
                {
                    initials: "DS",
                    name: "DEADSHOT",
                    level: 400,
                    mpRank: "Legendary",
                    brRank: "Legendary",
                    avatar: ""
                },
                {
                    initials: "SK",
                    name: "SniperKing",
                    level: 387,
                    mpRank: "Legendary",
                    brRank: "Master",
                    avatar: ""
                },
                {
                    initials: "TG",
                    name: "TacticalGamer",
                    level: 355,
                    mpRank: "Legendary",
                    brRank: "Legendary",
                    avatar: ""
                }
            ]
        };
        
        // Website settings
        let websiteSettings = {
            name: "GOATED Clan.CODM",
            tagline: "Elite Mobile Warfare | Season 7",
            logo: "",
            background: "",
            theme: "default",
            allowRegistration: true
        };
        
        let currentUser = null;
        let unreadAdminNotifications = 0;
        let selectedGender = null;
        
        // Helper function to format dates
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }
        
        // Show loading overlay
        function showLoading(message = "Loading...") {
            document.getElementById('loadingOverlay').style.display = 'flex';
            document.getElementById('loadingText').textContent = message;
        }
        
        // Hide loading overlay
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Simulate network delay
        function simulateNetworkDelay(callback, delay = 1000) {
            showLoading();
            setTimeout(() => {
                callback();
                hideLoading();
            }, delay);
        }
        
        // Show notification
        function showNotification(type, message, duration = 5000) {
            const notificationContainer = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'ℹ️';
            switch(type) {
                case 'success': icon = '✅'; break;
                case 'error': icon = '❌'; break;
                case 'warning': icon = '⚠️'; break;
            }
            
            notification.innerHTML = `
                <span class="notification-icon">${icon}</span>
                <span>${message}</span>
                <span class="notification-close" onclick="this.parentElement.remove()">×</span>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Trigger the animation
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // Auto-remove after duration
            if (duration > 0) {
                setTimeout(() => {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        notification.remove();
                    }, 300);
                }, duration);
            }
        }
        
        // Select gender during registration
        function selectGender(gender) {
            selectedGender = gender;
            const maleOption = document.querySelector('.gender-option.male');
            const femaleOption = document.querySelector('.gender-option.female');
            
            if (gender === 'male') {
                maleOption.classList.add('selected');
                femaleOption.classList.remove('selected');
                document.getElementById('robotAvatar').textContent = "🤖";
            } else {
                femaleOption.classList.add('selected');
                maleOption.classList.remove('selected');
                document.getElementById('robotAvatar').textContent = "👩";
            }
        }
        
        // Upload profile picture
        function uploadProfilePicture() {
            const fileInput = document.getElementById('profilePicUpload');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('error', 'Please select an image file');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) { // 2MB limit
                showNotification('error', 'Image size should be less than 2MB');
                return;
            }
            
            showLoading("Uploading profile picture...");
            
            const reader = new FileReader();
            reader.onload = function(e) {
                // Update user's profile picture in database
                users = users.map(user => {
                    if (user.id === currentUser.id) {
                        return {...user, profilePic: e.target.result};
                    }
                    return user;
                });
                
                currentUser.profilePic = e.target.result;
                
                // Update the profile pic display
                const profilePicContainer = document.querySelector('.profile-pic-container');
                profilePicContainer.innerHTML = `
                    <img id="userProfilePic" class="profile-pic" src="${e.target.result}" alt="Profile Picture">
                    <label class="profile-pic-upload">
                        <input type="file" id="profilePicUpload" accept="image/*" onchange="uploadProfilePicture()" capture="camera">
                        <i class="fas fa-camera"></i>
                    </label>
                `;
                
                showNotification('success', 'Profile picture updated successfully!');
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "profile-update",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `${currentUser.username} updated their profile picture`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                hideLoading();
            };
            reader.onerror = function() {
                showNotification('error', 'Error uploading profile picture');
                hideLoading();
            };
            reader.readAsDataURL(file);
        }
        
        // Preview clan logo
        function previewClanLogo() {
            const fileInput = document.getElementById('clanLogo');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('error', 'Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('clanLogoPreview').src = e.target.result;
                document.getElementById('clanLogoPreview').style.display = 'block';
                clanSettings.logo = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Preview clan banner
        function previewClanBanner() {
            const fileInput = document.getElementById('clanBanner');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('error', 'Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('clanBannerPreview').src = e.target.result;
                document.getElementById('clanBannerPreview').style.display = 'block';
                clanSettings.banner = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Preview website logo
        function previewWebsiteLogo() {
            const fileInput = document.getElementById('websiteLogo');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('error', 'Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('websiteLogoPreview').src = e.target.result;
                document.getElementById('websiteLogoPreview').style.display = 'block';
                websiteSettings.logo = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Preview website background
        function previewWebsiteBackground() {
            const fileInput = document.getElementById('websiteBackground');
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('error', 'Please select an image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('websiteBackgroundPreview').src = e.target.result;
                document.getElementById('websiteBackgroundPreview').style.display = 'block';
                websiteSettings.background = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        // Update member avatar in admin panel
        function updateMemberAvatar(memberId) {
            const fileInput = document.getElementById(`memberAvatarUpload_${memberId}`);
            const file = fileInput.files[0];
            
            if (!file) return;
            
            if (!file.type.match('image.*')) {
                showNotification('error', 'Please select an image file');
                return;
            }
            
            if (file.size > 2 * 1024 * 1024) { // 2MB limit
                showNotification('error', 'Image size should be less than 2MB');
                return;
            }
            
            showLoading("Updating member avatar...");
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = document.getElementById(`memberAvatar_${memberId}`);
                img.src = e.target.result;
                
                // Update in clan settings
                const memberIndex = clanSettings.topMembers.findIndex(m => 
                    `member${clanSettings.topMembers.indexOf(m) + 1}` === memberId
                );
                
                if (memberIndex !== -1) {
                    clanSettings.topMembers[memberIndex].avatar = e.target.result;
                }
                
                showNotification('success', 'Member avatar updated!');
                hideLoading();
            };
            reader.onerror = function() {
                showNotification('error', 'Error updating member avatar');
                hideLoading();
            };
            reader.readAsDataURL(file);
        }
        
        // Show login form
        function showLogin() {
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminLoginContainer').style.display = 'none';
            document.getElementById('loginError').textContent = '';
        }
        
        // Show register form
        function showRegister() {
            if (!websiteSettings.allowRegistration) {
                showNotification('error', 'New registrations are currently disabled by admin');
                return;
            }
            
            // Reset gender selection
            selectedGender = null;
            document.querySelector('.gender-option.male').classList.remove('selected');
            document.querySelector('.gender-option.female').classList.remove('selected');
            document.getElementById('robotAvatar').textContent = "🤖";
            
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'block';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminLoginContainer').style.display = 'none';
            document.getElementById('registerError').textContent = '';
            document.getElementById('registerSuccess').textContent = '';
        }
        
        // Show admin login
        function showAdminLogin() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('adminLoginContainer').style.display = 'block';
            document.getElementById('adminLoginError').textContent = '';
        }
        
        // Login function
        function login() {
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !password) {
                document.getElementById('loginError').textContent = "Please enter both username and password!";
                return;
            }
            
            showLoading("Authenticating...");
            
            // Simulate network delay
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);
                
                if (!user) {
                    document.getElementById('loginError').textContent = "Invalid username or password!";
                    hideLoading();
                    return;
                }
                
                currentUser = user;
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "login",
                    userId: user.id,
                    username: user.username,
                    message: `User logged in: ${user.username}`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Check for unread notifications
                if (user.isAdmin) {
                    unreadAdminNotifications = notifications.filter(n => n.userId === 2 && !n.read).length;
                    updateAdminNotificationBadge();
                } else {
                    const unreadUserNotifications = notifications.filter(n => n.userId === user.id && !n.read);
                    if (unreadUserNotifications.length > 0) {
                        showNotification('info', `You have ${unreadUserNotifications.length} unread notifications`, 3000);
                    }
                }
                
                if (user.isAdmin) {
                    showAdminDashboard();
                } else {
                    showUserDashboard();
                }
                
                hideLoading();
            }, 1000);
        }
        
        // Admin login
        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value.trim();
            
            if (!username || !password) {
                document.getElementById('adminLoginError').textContent = "Please enter both username and password!";
                return;
            }
            
            showLoading("Authenticating admin...");
            
            // Simulate network delay
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password && u.isAdmin);
                
                if (!user) {
                    document.getElementById('adminLoginError').textContent = "Invalid admin credentials!";
                    hideLoading();
                    return;
                }
                
                currentUser = user;
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "login",
                    userId: user.id,
                    username: user.username,
                    message: "Admin logged in",
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Check for unread notifications
                unreadAdminNotifications = notifications.filter(n => n.userId === 2 && !n.read).length;
                updateAdminNotificationBadge();
                
                showAdminDashboard();
                hideLoading();
            }, 1000);
        }
        
        // Register function
        function register() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value.trim();
            const codmName = document.getElementById('regCODMName').value.trim();
            const level = parseInt(document.getElementById('regLevel').value);
            const mpRank = document.getElementById('regMPRank').value;
            const brRank = document.getElementById('regBRRank').value;
            
            if (!username || !password || !codmName || !mpRank || !brRank || isNaN(level)) {
                document.getElementById('registerError').textContent = "All fields are required!";
                return;
            }
            
            if (!selectedGender) {
                document.getElementById('registerError').textContent = "Please select your gender!";
                return;
            }
            
            if (password.length < 8) {
                document.getElementById('registerError').textContent = "Password must be at least 8 characters!";
                return;
            }
            
            if (level < 1 || level > 400) {
                document.getElementById('registerError').textContent = "Level must be between 1 and 400!";
                return;
            }
            
            if (users.some(user => user.username === username)) {
                document.getElementById('registerError').textContent = "Username already exists!";
                return;
            }
            
            if (users.some(user => user.codmName === codmName)) {
                document.getElementById('registerError').textContent = "CODM name already registered!";
                return;
            }
            
            showLoading("Creating your account...");
            
            // Simulate network delay
            setTimeout(() => {
                const robotAvatar = selectedGender === 'male' ? '🤖' : '👩';
                
                const newUser = {
                    id: users.length + 1,
                    username,
                    password,
                    codmName,
                    level,
                    mpRank,
                    brRank,
                    isAdmin: false,
                    status: "Applicant",
                    joinDate: new Date().toISOString(),
                    notifications: [],
                    profilePic: "",
                    gender: selectedGender,
                    robotAvatar
                };
                
                users.push(newUser);
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "registration",
                    userId: newUser.id,
                    username: newUser.username,
                    message: `New user registered: ${username} (${codmName})`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Notify admin
                addUserNotification(
                    2, // Admin user ID
                    "new-user",
                    "New User Registration",
                    `${username} (${codmName}) has registered an account`,
                    newUser.id
                );
                
                // Clear form
                document.getElementById('regUsername').value = "";
                document.getElementById('regPassword').value = "";
                document.getElementById('regCODMName').value = "";
                document.getElementById('regLevel').value = "";
                document.getElementById('regMPRank').value = "";
                document.getElementById('regBRRank').value = "";
                
                document.getElementById('registerError').textContent = "";
                document.getElementById('registerSuccess').textContent = "Registration successful! You can now login.";
                
                showNotification('success', 'Registration successful! You can now login.');
                hideLoading();
            }, 1500);
        }
        
        // Show user dashboard
        function showUserDashboard() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('adminLoginContainer').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'block';
            
            // Update user info
            document.getElementById('dashboardUsername').textContent = currentUser.username;
            document.getElementById('dashboardGender').textContent = currentUser.gender === 'male' ? 'Male' : 'Female';
            document.getElementById('dashboardCODMName').textContent = currentUser.codmName;
            document.getElementById('dashboardLevel').textContent = currentUser.level;
            document.getElementById('dashboardMPRank').textContent = currentUser.mpRank;
            document.getElementById('dashboardBRRank').textContent = currentUser.brRank;
            
            // Set profile picture or robot avatar
            const profilePicContainer = document.querySelector('.profile-pic-container');
            if (currentUser.profilePic) {
                profilePicContainer.innerHTML = `
                    <img id="userProfilePic" class="profile-pic" src="${currentUser.profilePic}" alt="Profile Picture">
                    <label class="profile-pic-upload">
                        <input type="file" id="profilePicUpload" accept="image/*" onchange="uploadProfilePicture()" capture="camera">
                        <i class="fas fa-camera"></i>
                    </label>
                `;
            } else {
                document.getElementById('userRobotAvatar').textContent = currentUser.robotAvatar;
                document.getElementById('userRobotAvatar').style.display = 'flex';
            }
            
            // Set status
            const statusElement = document.getElementById('dashboardStatus');
            statusElement.textContent = currentUser.status;
            statusElement.className = 'status-badge';
            
            if (currentUser.status === "Pending") {
                statusElement.classList.add('status-pending');
            } else if (currentUser.status === "Accepted") {
                statusElement.classList.add('status-accepted');
            } else if (currentUser.status === "Rejected") {
                statusElement.classList.add('status-rejected');
            } else if (currentUser.status === "Member") {
                statusElement.classList.add('status-member');
            } else if (currentUser.status === "Admin") {
                statusElement.classList.add('status-admin');
            } else if (currentUser.status === "Applicant") {
                statusElement.classList.add('status-applicant');
            }
            
            // Show/hide banner upload button based on admin status
            document.getElementById('clanBannerUploadBtn').style.display = currentUser.isAdmin ? 'block' : 'none';
            
            // Set clan banner
            const clanBannerImg = document.getElementById('clanBannerImg');
            if (clanSettings.banner) {
                clanBannerImg.src = clanSettings.banner;
                clanBannerImg.style.display = 'block';
            } else {
                clanBannerImg.src = '';
                clanBannerImg.style.display = 'none';
            }
            
            // Check for existing application
            const userApp = applications.find(app => app.userId === currentUser.id);
            if (userApp) {
                document.getElementById('statusMessage').innerHTML = `
                    <p>Your application status: 
                        <span class="status-badge status-${userApp.status.toLowerCase()}">
                            ${userApp.status}
                        </span>
                    </p>
                    <p>Submitted on: ${formatDate(userApp.applyDate)}</p>
                    <p>MP Rank: ${userApp.mpRank} | BR Rank: ${userApp.brRank}</p>
                    <p>Level: ${userApp.level}</p>
                    <p>Reason: ${userApp.reason}</p>
                `;
            }
            
            // Update clan info display
            updateClanInfoDisplay();
            
            // Reset tabs to default
            document.querySelectorAll('#userDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#userDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelector('#userDashboard .tab').classList.add('active');
            document.querySelector('#userDashboard .tab-content').classList.add('active');
        }
        
        // Show admin dashboard
        function showAdminDashboard() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('registerContainer').style.display = 'none';
            document.getElementById('adminLoginContainer').style.display = 'none';
            document.getElementById('userDashboard').style.display = 'none';
            document.getElementById('adminDashboard').style.display = 'block';
            
            // Update last login time
            document.getElementById('lastLoginTime').textContent = formatDate(new Date());
            
            // Load applications
            loadApplications();
            
            // Load users
            loadUsers();
            
            // Load activity logs
            loadActivityLogs();
            
            // Load notifications
            loadNotifications();
            
            // Load clan settings
            loadClanSettings();
            
            // Load website settings
            loadWebsiteSettings();
            
            // Reset tabs to default
            document.querySelectorAll('#adminDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#adminDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelector('#adminDashboard .tab').classList.add('active');
            document.querySelector('#adminDashboard .tab-content').classList.add('active');
        }
        
        // Load applications
        function loadApplications() {
            const applicationsList = document.getElementById('applicationsList');
            applicationsList.innerHTML = '';
            
            const pendingApps = applications.filter(app => app.status === "Pending");
            const pendingCount = document.getElementById('pendingAppsCount');
            
            if (pendingApps.length === 0) {
                applicationsList.innerHTML = '<p>No pending applications.</p>';
                pendingCount.style.display = 'none';
            } else {
                pendingCount.textContent = pendingApps.length;
                pendingCount.style.display = 'inline-block';
                
                pendingApps.forEach(app => {
                    const card = document.createElement('div');
                    card.className = 'user-card';
                    card.innerHTML = `
                        <h4>${app.codmName} (${app.username})</h4>
                        <p>Level: ${app.level} | MP: ${app.mpRank} | BR: ${app.brRank}</p>
                        <p>Applied on: ${formatDate(app.applyDate)}</p>
                        <p>${app.reason}</p>
                        <div class="admin-actions">
                            <button class="accept-btn" onclick="updateApplication(${app.id}, 'Accepted')">
                                <i class="fas fa-check"></i> Accept
                            </button>
                            <button class="reject-btn" onclick="updateApplication(${app.id}, 'Rejected')">
                                <i class="fas fa-times"></i> Reject
                            </button>
                        </div>
                    `;
                    applicationsList.appendChild(card);
                });
            }
        }
        
        // Load users
        function loadUsers() {
            const usersList = document.getElementById('usersList');
            usersList.innerHTML = '';
            
            const regularUsers = users.filter(user => !user.isAdmin);
            
            if (regularUsers.length === 0) {
                usersList.innerHTML = '<p>No users found.</p>';
            } else {
                regularUsers.forEach(user => {
                    const card = document.createElement('div');
                    card.className = 'user-card';
                    
                    let avatarContent = '';
                    if (user.profilePic) {
                        avatarContent = `<img src="${user.profilePic}" style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; object-fit: cover;">`;
                    } else {
                        avatarContent = `<div style="width: 40px; height: 40px; border-radius: 50%; margin-right: 10px; background: #333; color: white; display: flex; align-items: center; justify-content: center; font-size: 20px;">${user.robotAvatar}</div>`;
                    }
                    
                    card.innerHTML = `
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            ${avatarContent}
                            <div>
                                <h4>${user.username} (${user.codmName})</h4>
                                <p>Level: ${user.level} | MP: ${user.mpRank} | BR: ${user.brRank}</p>
                            </div>
                        </div>
                        <p>Gender: ${user.gender === 'male' ? 'Male' : 'Female'}</p>
                        <p>Status: <span class="status-badge status-${user.status.toLowerCase()}">${user.status}</span></p>
                        <p>Joined: ${formatDate(user.joinDate)}</p>
                        <div class="admin-actions">
                            <button class="accept-btn" onclick="updateUserStatus(${user.id}, 'Member')">
                                <i class="fas fa-user-check"></i> Make Member
                            </button>
                            <button class="reject-btn" onclick="updateUserStatus(${user.id}, 'Applicant')">
                                <i class="fas fa-user-edit"></i> Set as Applicant
                            </button>
                            <button class="ban-btn" onclick="banUser(${user.id})">
                                <i class="fas fa-ban"></i> Ban User
                            </button>
                        </div>
                    `;
                    usersList.appendChild(card);
                });
            }
        }
        
        // Load activity logs
        function loadActivityLogs() {
            const activityLog = document.getElementById('activityLog');
            activityLog.innerHTML = '';
            
            if (activityLogs.length === 0) {
                activityLog.innerHTML = '<p>No activity logs found.</p>';
                return;
            }
            
            activityLogs.forEach(log => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                let icon = '';
                let color = 'inherit';
                
                switch(log.type) {
                    case 'login':
                        icon = '🔒';
                        break;
                    case 'registration':
                        icon = '🆕';
                        color = 'var(--success)';
                        break;
                    case 'application':
                        icon = '📝';
                        color = 'var(--info)';
                        break;
                    case 'status-change':
                        icon = '🔄';
                        color = 'var(--warning)';
                        break;
                    case 'ban':
                        icon = '❌';
                        color = 'var(--danger)';
                        break;
                    case 'password-change':
                        icon = '🔑';
                        break;
                    case 'account-delete':
                        icon = '💀';
                        color = 'var(--danger)';
                        break;
                    case 'clan-settings':
                        icon = '⚙️';
                        color = 'var(--primary)';
                        break;
                    case 'profile-update':
                        icon = '🖼️';
                        color = 'var(--info)';
                        break;
                    case 'website-settings':
                        icon = '🌐';
                        color = 'var(--legendary)';
                        break;
                    default:
                        icon = 'ℹ️';
                }
                
                item.innerHTML = `
                    <div style="color: ${color}">${icon} ${log.message}</div>
                    <div class="activity-time">${formatDate(log.timestamp)}</div>
                `;
                activityLog.appendChild(item);
            });
        }
        
        // Load notifications
        function loadNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            notificationsList.innerHTML = '';
            
            const adminNotifications = notifications
                .filter(n => n.userId === 2) // Admin user ID is 2
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            if (adminNotifications.length === 0) {
                notificationsList.innerHTML = '<p>No notifications found.</p>';
                return;
            }
            
            adminNotifications.forEach(notification => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                let icon = '';
                let color = 'inherit';
                
                switch(notification.type) {
                    case 'new-application':
                        icon = '📝';
                        color = 'var(--info)';
                        break;
                    case 'new-user':
                        icon = '🆕';
                        color = 'var(--success)';
                        break;
                    case 'user-action':
                        icon = '👤';
                        color = 'var(--warning)';
                        break;
                    default:
                        icon = 'ℹ️';
                }
                
                item.innerHTML = `
                    <div style="color: ${color}">
                        <strong>${notification.title}</strong><br>
                        ${notification.message}
                    </div>
                    <div class="activity-time">${formatDate(notification.timestamp)}</div>
                `;
                
                if (!notification.read) {
                    item.style.backgroundColor = 'rgba(255, 70, 85, 0.1)';
                    item.style.borderLeft = '3px solid var(--primary)';
                    item.onclick = function() {
                        markNotificationAsRead(notification.id);
                        item.style.backgroundColor = '';
                        item.style.borderLeft = '';
                    };
                }
                
                notificationsList.appendChild(item);
            });
        }
        
        // Load clan settings into form
        function loadClanSettings() {
            document.getElementById('clanName').value = clanSettings.name;
            document.getElementById('clanTag').value = clanSettings.tag;
            
            // Reset file inputs
            document.getElementById('clanLogo').value = '';
            document.getElementById('clanBanner').value = '';
            
            document.getElementById('totalMembersSetting').value = clanSettings.stats.totalMembers;
            document.getElementById('legendaryPlayersSetting').value = clanSettings.stats.legendaryPlayers;
            document.getElementById('avgLevelSetting').value = clanSettings.stats.avgLevel;
            document.getElementById('winRateSetting').value = clanSettings.stats.winRate;
            
            // Show previews if URLs exist
            if (clanSettings.logo) {
                document.getElementById('clanLogoPreview').src = clanSettings.logo;
                document.getElementById('clanLogoPreview').style.display = 'block';
            }
            
            if (clanSettings.banner) {
                document.getElementById('clanBannerPreview').src = clanSettings.banner;
                document.getElementById('clanBannerPreview').style.display = 'block';
            }
            
            // Load activities
            const activitiesContainer = document.getElementById('clanActivities');
            activitiesContainer.innerHTML = '';
            clanSettings.activities.forEach((activity, index) => {
                addActivityField(activity.icon, activity.text, activity.daysAgo, 'activity' + (index + 1));
            });
            
            // Load top members
            const topMembersContainer = document.getElementById('topMembers');
            topMembersContainer.innerHTML = '';
            clanSettings.topMembers.forEach((member, index) => {
                addTopMemberField(
                    member.initials, 
                    member.name, 
                    member.level, 
                    member.mpRank, 
                    member.brRank, 
                    member.avatar,
                    'member' + (index + 1)
                );
            });
        }
        
        // Load website settings into form
        function loadWebsiteSettings() {
            document.getElementById('websiteName').value = websiteSettings.name;
            document.getElementById('websiteTagline').value = websiteSettings.tagline;
            
            // Reset file inputs
            document.getElementById('websiteLogo').value = '';
            document.getElementById('websiteBackground').value = '';
            
            document.getElementById('websiteTheme').value = websiteSettings.theme;
            document.getElementById('websiteRegistration').value = websiteSettings.allowRegistration ? 'true' : 'false';
            
            // Show previews if URLs exist
            if (websiteSettings.logo) {
                document.getElementById('websiteLogoPreview').src = websiteSettings.logo;
                document.getElementById('websiteLogoPreview').style.display = 'block';
            }
            
            if (websiteSettings.background) {
                document.getElementById('websiteBackgroundPreview').src = websiteSettings.background;
                document.getElementById('websiteBackgroundPreview').style.display = 'block';
            }
        }
        
        // Add activity field
        function addActivityField(icon = "ℹ️", text = "", daysAgo = 0, id = null) {
            const activitiesContainer = document.getElementById('clanActivities');
            const activityId = id || 'activity' + Date.now();
            
            const activityDiv = document.createElement('div');
            activityDiv.className = 'activity-edit-item';
            activityDiv.innerHTML = `
                <button class="remove-activity" onclick="removeActivityField('${activityId}')">×</button>
                <div class="form-group">
                    <label>Icon</label>
                    <input type="text" id="activityIcon_${activityId}" value="${icon}" placeholder="Enter emoji icon">
                </div>
                <div class="form-group">
                    <label>Activity Text</label>
                    <input type="text" id="activityText_${activityId}" value="${text}" placeholder="Enter activity description">
                </div>
                <div class="form-group">
                    <label>Days Ago</label>
                    <input type="number" id="activityDays_${activityId}" value="${daysAgo}" min="0" placeholder="How many days ago">
                </div>
            `;
            
            activitiesContainer.appendChild(activityDiv);
        }
        
        // Add top member field
        function addTopMemberField(initials = "", name = "", level = "", mpRank = "", brRank = "", avatar = "", id = null) {
            const topMembersContainer = document.getElementById('topMembers');
            const memberId = id || 'member' + Date.now();
            
            const memberDiv = document.createElement('div');
            memberDiv.className = 'member-edit-item';
            memberDiv.innerHTML = `
                <button class="remove-member" onclick="removeMemberField('${memberId}')">×</button>
                <div class="member-edit-fields">
                    <div class="member-avatar-edit">
                        <img id="memberAvatar_${memberId}" src="${avatar || 'https://via.placeholder.com/40'}" alt="${initials}">
                        <input type="file" id="memberAvatarUpload_${memberId}" accept="image/*" style="display: none;" onchange="updateMemberAvatar('${memberId}')" capture="camera">
                        <label for="memberAvatarUpload_${memberId}" style="position: absolute; bottom: -5px; right: -5px; background: var(--primary); color: white; border-radius: 50%; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; font-size: 12px; cursor: pointer;">+</label>
                    </div>
                    <div style="flex: 1;">
                        <div class="form-group">
                            <input type="text" id="memberName_${memberId}" value="${name}" placeholder="Member name">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label>Level</label>
                    <input type="number" id="memberLevel_${memberId}" value="${level}" min="1" max="400" placeholder="Member level">
                </div>
                <div class="rank-info">
                    <div class="rank-column">
                        <label>MP Rank</label>
                        <select id="memberMPRank_${memberId}">
                            <option value="Rookie" ${mpRank === "Rookie" ? "selected" : ""}>Rookie</option>
                            <option value="Veteran" ${mpRank === "Veteran" ? "selected" : ""}>Veteran</option>
                            <option value="Elite" ${mpRank === "Elite" ? "selected" : ""}>Elite</option>
                            <option value="Pro" ${mpRank === "Pro" ? "selected" : ""}>Pro</option>
                            <option value="Master" ${mpRank === "Master" ? "selected" : ""}>Master</option>
                            <option value="Legendary" ${mpRank === "Legendary" ? "selected" : ""}>Legendary</option>
                        </select>
                    </div>
                    <div class="rank-column">
                        <label>BR Rank</label>
                        <select id="memberBRRank_${memberId}">
                            <option value="Rookie" ${brRank === "Rookie" ? "selected" : ""}>Rookie</option>
                            <option value="Veteran" ${brRank === "Veteran" ? "selected" : ""}>Veteran</option>
                            <option value="Elite" ${brRank === "Elite" ? "selected" : ""}>Elite</option>
                            <option value="Pro" ${brRank === "Pro" ? "selected" : ""}>Pro</option>
                            <option value="Master" ${brRank === "Master" ? "selected" : ""}>Master</option>
                            <option value="Legendary" ${brRank === "Legendary" ? "selected" : ""}>Legendary</option>
                        </select>
                    </div>
                </div>
            `;
            
            topMembersContainer.appendChild(memberDiv);
        }
        
        // Remove activity field
        function removeActivityField(id) {
            if (document.querySelectorAll('.activity-edit-item').length <= 1) {
                showNotification('error', 'You must have at least one activity item');
                return;
            }
            
            const activityDiv = document.querySelector(`.activity-edit-item button[onclick="removeActivityField('${id}')"]`)?.parentElement;
            if (activityDiv) {
                activityDiv.remove();
            }
        }
        
        // Remove member field
        function removeMemberField(id) {
            if (document.querySelectorAll('.member-edit-item').length <= 1) {
                showNotification('error', 'You must have at least one top member');
                return;
            }
            
            const memberDiv = document.querySelector(`.member-edit-item button[onclick="removeMemberField('${id}')"]`)?.parentElement;
            if (memberDiv) {
                memberDiv.remove();
            }
        }
        
        // Save clan settings
        function saveClanSettings() {
            showLoading("Saving clan settings...");
            
            try {
                // Basic info
                clanSettings.name = document.getElementById('clanName').value || "GOATED Clan.CODM";
                clanSettings.tag = document.getElementById('clanTag').value || "GOAT";
                
                // Stats
                clanSettings.stats = {
                    totalMembers: parseInt(document.getElementById('totalMembersSetting').value) || 0,
                    legendaryPlayers: parseInt(document.getElementById('legendaryPlayersSetting').value) || 0,
                    avgLevel: parseInt(document.getElementById('avgLevelSetting').value) || 1,
                    winRate: parseInt(document.getElementById('winRateSetting').value) || 0
                };
                
                // Activities
                clanSettings.activities = [];
                const activityItems = document.querySelectorAll('.activity-edit-item');
                activityItems.forEach(item => {
                    const id = item.querySelector('button').onclick.toString().match(/'([^']+)'/)[1];
                    clanSettings.activities.push({
                        icon: document.getElementById(`activityIcon_${id}`).value || "ℹ️",
                        text: document.getElementById(`activityText_${id}`).value || "",
                        daysAgo: parseInt(document.getElementById(`activityDays_${id}`).value) || 0
                    });
                });
                
                // Top members
                clanSettings.topMembers = [];
                const memberItems = document.querySelectorAll('.member-edit-item');
                memberItems.forEach(item => {
                    const id = item.querySelector('button').onclick.toString().match(/'([^']+)'/)[1];
                    clanSettings.topMembers.push({
                        initials: document.getElementById(`memberName_${id}`).value.substring(0, 2).toUpperCase(),
                        name: document.getElementById(`memberName_${id}`).value || "Unknown",
                        level: parseInt(document.getElementById(`memberLevel_${id}`).value) || 1,
                        mpRank: document.getElementById(`memberMPRank_${id}`).value || "Rookie",
                        brRank: document.getElementById(`memberBRRank_${id}`).value || "Rookie",
                        avatar: document.getElementById(`memberAvatar_${id}`).src
                    });
                });
                
                // Update clan info display
                updateClanInfoDisplay();
                
                document.getElementById('clanSettingsError').textContent = "";
                document.getElementById('clanSettingsSuccess').textContent = "Clan settings saved successfully!";
                showNotification('success', 'Clan settings updated successfully!');
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "clan-settings",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `${currentUser.username} updated clan settings`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
            } catch (error) {
                document.getElementById('clanSettingsError').textContent = "Error saving clan settings: " + error.message;
                document.getElementById('clanSettingsSuccess').textContent = "";
                showNotification('error', 'Error saving clan settings');
            } finally {
                hideLoading();
            }
        }
        
        // Save website settings
        function saveWebsiteSettings() {
            showLoading("Saving website settings...");
            
            try {
                // Basic info
                websiteSettings.name = document.getElementById('websiteName').value || "GOATED Clan.CODM";
                websiteSettings.tagline = document.getElementById('websiteTagline').value || "Elite Mobile Warfare";
                websiteSettings.theme = document.getElementById('websiteTheme').value;
                websiteSettings.allowRegistration = document.getElementById('websiteRegistration').value === 'true';
                
                // Update website display
                updateWebsiteDisplay();
                
                document.getElementById('websiteSettingsError').textContent = "";
                document.getElementById('websiteSettingsSuccess').textContent = "Website settings saved successfully!";
                showNotification('success', 'Website settings updated successfully!');
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "website-settings",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `${currentUser.username} updated website settings`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
            } catch (error) {
                document.getElementById('websiteSettingsError').textContent = "Error saving website settings: " + error.message;
                document.getElementById('websiteSettingsSuccess').textContent = "";
                showNotification('error', 'Error saving website settings');
            } finally {
                hideLoading();
            }
        }
        
        // Update clan info display
        function updateClanInfoDisplay() {
            // Update stats
            document.getElementById('totalMembers').textContent = clanSettings.stats.totalMembers;
            document.getElementById('legendaryPlayers').textContent = clanSettings.stats.legendaryPlayers;
            document.getElementById('avgLevel').textContent = clanSettings.stats.avgLevel;
            document.getElementById('winRate').textContent = clanSettings.stats.winRate + "%";
            
            // Update activities
            const activityLog = document.getElementById('clanActivityLog');
            if (activityLog) {
                activityLog.innerHTML = '';
                clanSettings.activities.forEach(activity => {
                    const item = document.createElement('div');
                    item.className = 'activity-item';
                    item.innerHTML = `
                        <div>${activity.icon} ${activity.text}</div>
                        <div class="activity-time">${activity.daysAgo} day${activity.daysAgo !== 1 ? 's' : ''} ago</div>
                    `;
                    activityLog.appendChild(item);
                });
            }
            
            // Update top members
            const memberList = document.getElementById('clanTopMembers');
            if (memberList) {
                memberList.innerHTML = '';
                clanSettings.topMembers.forEach(member => {
                    const item = document.createElement('div');
                    item.className = 'member-item';
                    
                    let avatarContent = '';
                    if (member.avatar) {
                        avatarContent = `<img src="${member.avatar}" alt="${member.initials}">`;
                    } else {
                        avatarContent = `<div style="width: 40px; height: 40px; border-radius: 50%; background: #333; color: white; display: flex; align-items: center; justify-content: center; font-size: 16px;">${member.initials}</div>`;
                    }
                    
                    item.innerHTML = `
                        <div class="member-avatar">${avatarContent}</div>
                        <div class="member-info">
                            <div class="member-name">${member.name}</div>
                            <div class="member-details">Level ${member.level} | MP: ${member.mpRank} | BR: ${member.brRank}</div>
                        </div>
                    `;
                    memberList.appendChild(item);
                });
            }
            
            // Update clan name in header if needed
            const logoElements = document.querySelectorAll('.logo');
            logoElements.forEach(el => {
                el.textContent = clanSettings.name;
            });
            
            // Update clan banner
            const clanBannerImg = document.getElementById('clanBannerImg');
            if (clanSettings.banner) {
                clanBannerImg.src = clanSettings.banner;
                clanBannerImg.style.display = 'block';
            } else {
                clanBannerImg.style.display = 'none';
            }
            
            // Update logo preview
            const logoPreview = document.getElementById('clanLogoPreview');
            if (clanSettings.logo) {
                logoPreview.src = clanSettings.logo;
                logoPreview.style.display = 'block';
            } else {
                logoPreview.style.display = 'none';
            }
        }
        
        // Update website display
        function updateWebsiteDisplay() {
            // Update main logo and tagline
            document.getElementById('mainLogo').textContent = websiteSettings.name;
            document.getElementById('mainTagline').textContent = websiteSettings.tagline;
            document.getElementById('registerLogo').textContent = "Join " + websiteSettings.name;
            
            // Update background
            if (websiteSettings.background) {
                document.body.style.backgroundImage = `url('${websiteSettings.background}')`;
            } else {
                document.body.style.backgroundImage = '';
            }
            
            // Update logo preview
            const logoPreview = document.getElementById('websiteLogoPreview');
            if (websiteSettings.logo) {
                logoPreview.src = websiteSettings.logo;
                logoPreview.style.display = 'block';
            } else {
                logoPreview.style.display = 'none';
            }
            
            // Update background preview
            const backgroundPreview = document.getElementById('websiteBackgroundPreview');
            if (websiteSettings.background) {
                backgroundPreview.src = websiteSettings.background;
                backgroundPreview.style.display = 'block';
            } else {
                backgroundPreview.style.display = 'none';
            }
            
            // Update theme
            applyTheme(websiteSettings.theme);
        }
        
        // Apply theme
        function applyTheme(theme) {
            const root = document.documentElement;
            
            switch(theme) {
                case 'blue':
                    root.style.setProperty('--primary', '#2196F3');
                    break;
                case 'green':
                    root.style.setProperty('--primary', '#4CAF50');
                    break;
                case 'purple':
                    root.style.setProperty('--primary', '#9c27b0');
                    break;
                case 'gold':
                    root.style.setProperty('--primary', '#FFD700');
                    break;
                default: // default theme
                    root.style.setProperty('--primary', '#ff4655');
            }
        }
        
        // Update application status
        function updateApplication(id, status) {
            showLoading("Updating application...");
            
            setTimeout(() => {
                const app = applications.find(a => a.id === id);
                if (!app) {
                    hideLoading();
                    return;
                }
                
                applications = applications.map(a => {
                    if (a.id === id) {
                        return {...a, status, reviewed: true};
                    }
                    return a;
                });
                
                // Update user status if accepted
                if (status === "Accepted") {
                    users = users.map(user => {
                        if (user.id === app.userId) {
                            return {...user, status: "Member"};
                        }
                        return user;
                    });
                }
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "status-change",
                    userId: app.userId,
                    username: app.username,
                    message: `Application ${status.toLowerCase()} for ${app.username} (${app.codmName})`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Notify user
                const notificationType = status === "Accepted" ? "success" : "warning";
                const notificationMessage = status === "Accepted" 
                    ? `Congratulations! Your application to join ${clanSettings.name} has been accepted.` 
                    : `Your application to join ${clanSettings.name} has been rejected.`;
                
                addUserNotification(
                    app.userId,
                    "application-status",
                    "Application Update",
                    notificationMessage,
                    app.id
                );
                
                // Show notification to admin
                showNotification('success', `Application ${status.toLowerCase()} for ${app.username}`);
                
                loadApplications();
                hideLoading();
            }, 1000);
        }
        
        // Update user status
        function updateUserStatus(userId, status) {
            showLoading("Updating user status...");
            
            setTimeout(() => {
                const user = users.find(u => u.id === userId);
                if (!user) {
                    hideLoading();
                    return;
                }
                
                users = users.map(u => {
                    if (u.id === userId) {
                        return {...u, status};
                    }
                    return u;
                });
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "status-change",
                    userId: user.id,
                    username: user.username,
                    message: `Status changed to ${status} for ${user.username}`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Notify user
                addUserNotification(
                    userId,
                    "status-change",
                    "Status Update",
                    `Your clan status has been updated to ${status}`,
                    userId
                );
                
                loadUsers();
                hideLoading();
            }, 1000);
        }
        
        // Ban user
        function banUser(userId) {
            if (!confirm(`Are you sure you want to ban this user? This action cannot be undone.`)) {
                return;
            }
            
            showLoading("Banning user...");
            
            setTimeout(() => {
                const user = users.find(u => u.id === userId);
                if (!user) {
                    hideLoading();
                    return;
                }
                
                users = users.filter(u => u.id !== userId);
                applications = applications.filter(app => app.userId !== userId);
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "ban",
                    userId: user.id,
                    username: user.username,
                    message: `User banned: ${user.username} (${user.codmName})`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Notify user if they're currently logged in
                if (currentUser && currentUser.id === userId) {
                    showNotification('error', 'Your account has been banned by an admin.');
                    setTimeout(logout, 3000);
                }
                
                loadUsers();
                hideLoading();
            }, 1000);
        }
        
        // Add user notification
        function addUserNotification(userId, type, title, message, relatedId) {
            const notification = {
                id: notifications.length + 1,
                userId,
                type,
                title,
                message,
                timestamp: new Date().toISOString(),
                read: false,
                relatedId
            };
            
            notifications.push(notification);
            
            // Update admin notification badge if needed
            if (userId === 2 && currentUser && currentUser.id === 2) {
                unreadAdminNotifications++;
                updateAdminNotificationBadge();
            }
            
            return notification;
        }
        
        // Mark notification as read
        function markNotificationAsRead(id) {
            notifications = notifications.map(n => {
                if (n.id === id) {
                    return {...n, read: true};
                }
                return n;
            });
            
            if (currentUser && currentUser.id === 2) {
                unreadAdminNotifications--;
                updateAdminNotificationBadge();
            }
        }
        
        // Update admin notification badge
        function updateAdminNotificationBadge() {
            const badge = document.getElementById('adminNotificationBadge');
            if (unreadAdminNotifications > 0) {
                badge.textContent = unreadAdminNotifications;
                badge.style.display = 'flex';
            } else {
                badge.style.display = 'none';
            }
        }
        
        // Switch tabs in user dashboard
        function switchTab(tabId) {
            document.querySelectorAll('#userDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#userDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
        }
        
        // Switch tabs in admin dashboard
        function switchAdminTab(tabId) {
            document.querySelectorAll('#adminDashboard .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('#adminDashboard .tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(tabId).classList.add('active');
            
            // Mark notifications as read when viewing them
            if (tabId === 'notificationsTab') {
                notifications.forEach(n => {
                    if (n.userId === 2 && !n.read) {
                        markNotificationAsRead(n.id);
                    }
                });
            }
        }
        
        // Show application form
        function showApplicationForm() {
            document.getElementById('applicationForm').style.display = 'block';
            document.getElementById('statusMessage').style.display = 'none';
        }
        
        // Hide application form
        function hideApplicationForm() {
            document.getElementById('applicationForm').style.display = 'none';
            document.getElementById('statusMessage').style.display = 'block';
        }
        
        // Submit application
        function submitApplication() {
            const reason = document.getElementById('applicationReason').value.trim();
            
            if (!reason || reason.length < 100) {
                alert("Please provide at least 100 characters explaining why you want to join!");
                return;
            }
            
            showLoading("Submitting application...");
            
            setTimeout(() => {
                // Remove any existing application
                applications = applications.filter(app => app.userId !== currentUser.id);
                
                const newApp = {
                    id: applications.length + 1,
                    userId: currentUser.id,
                    username: currentUser.username,
                    codmName: currentUser.codmName,
                    level: currentUser.level,
                    mpRank: currentUser.mpRank,
                    brRank: currentUser.brRank,
                    reason,
                    status: "Pending",
                    applyDate: new Date().toISOString(),
                    reviewed: false
                };
                
                applications.push(newApp);
                
                // Update user status
                users = users.map(user => {
                    if (user.id === currentUser.id) {
                        return {...user, status: "Pending"};
                    }
                    return user;
                });
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "application",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `New application submitted by ${currentUser.username}`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Notify admin
                addUserNotification(
                    2, // Admin user ID
                    "new-application",
                    "New Clan Application",
                    `${currentUser.username} has submitted an application to join the clan`,
                    newApp.id
                );
                
                // Notify user
                addUserNotification(
                    currentUser.id,
                    "application-status",
                    "Application Submitted",
                    "Your clan application has been submitted and is pending review",
                    newApp.id
                );
                
                document.getElementById('applicationReason').value = "";
                hideApplicationForm();
                showUserDashboard();
                
                showNotification('success', 'Application submitted successfully! The admin has been notified.');
                hideLoading();
            }, 1000);
        }
        
        // Change password
        function changePassword() {
            const currentPassword = document.getElementById('changePasswordCurrent').value.trim();
            const newPassword = document.getElementById('changePasswordNew').value.trim();
            const confirmPassword = document.getElementById('changePasswordConfirm').value.trim();
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                document.getElementById('passwordChangeError').textContent = "All fields are required!";
                document.getElementById('passwordChangeSuccess').textContent = "";
                return;
            }
            
            if (currentUser.password !== currentPassword) {
                document.getElementById('passwordChangeError').textContent = "Current password is incorrect!";
                document.getElementById('passwordChangeSuccess').textContent = "";
                return;
            }
            
            if (newPassword.length < 8) {
                document.getElementById('passwordChangeError').textContent = "New password must be at least 8 characters!";
                document.getElementById('passwordChangeSuccess').textContent = "";
                return;
            }
            
            if (newPassword !== confirmPassword) {
                document.getElementById('passwordChangeError').textContent = "New passwords don't match!";
                document.getElementById('passwordChangeSuccess').textContent = "";
                return;
            }
            
            showLoading("Updating password...");
            
            setTimeout(() => {
                // Update password
                users = users.map(user => {
                    if (user.id === currentUser.id) {
                        return {...user, password: newPassword};
                    }
                    return user;
                });
                
                currentUser.password = newPassword;
                
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "password-change",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `Password changed for ${currentUser.username}`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                document.getElementById('passwordChangeError').textContent = "";
                document.getElementById('passwordChangeSuccess').textContent = "Password changed successfully!";
                
                // Clear fields
                document.getElementById('changePasswordCurrent').value = "";
                document.getElementById('changePasswordNew').value = "";
                document.getElementById('changePasswordConfirm').value = "";
                
                showNotification('success', 'Password changed successfully!');
                hideLoading();
            }, 1000);
        }
        
        // Confirm account deletion
        function confirmDeleteAccount() {
            if (confirm("Are you absolutely sure you want to delete your account? This will permanently remove all your data and cannot be undone.")) {
                deleteAccount();
            }
        }
        
        // Delete account
        function deleteAccount() {
            showLoading("Deleting account...");
            
            setTimeout(() => {
                // Log activity before deletion
                const activity = {
                    id: activityLogs.length + 1,
                    type: "account-delete",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `Account deleted: ${currentUser.username} (${currentUser.codmName})`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
                
                // Notify admin
                addUserNotification(
                    2, // Admin user ID
                    "user-action",
                    "Account Deleted",
                    `${currentUser.username} has deleted their account`,
                    currentUser.id
                );
                
                // Remove user data
                users = users.filter(user => user.id !== currentUser.id);
                applications = applications.filter(app => app.userId !== currentUser.id);
                
                // Logout
                logout();
                showNotification('error', 'Your account has been permanently deleted.', 3000);
                hideLoading();
            }, 1000);
        }
        
        // Logout
        function logout() {
            if (currentUser) {
                // Log activity
                const activity = {
                    id: activityLogs.length + 1,
                    type: "logout",
                    userId: currentUser.id,
                    username: currentUser.username,
                    message: `User logged out: ${currentUser.username}`,
                    timestamp: new Date().toISOString()
                };
                activityLogs.unshift(activity);
            }
            
            currentUser = null;
            document.getElementById('username').value = "";
            document.getElementById('password').value = "";
            document.getElementById('adminUsername').value = "";
            document.getElementById('adminPassword').value = "";
            showLogin();
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showLogin();
            updateWebsiteDisplay();
            
            // Initialize clan info display
            updateClanInfoDisplay();
        });
    </script>
</body>
</html>